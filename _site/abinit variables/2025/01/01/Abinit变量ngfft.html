<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Abinit变量ngfft | ZWei</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Abinit变量ngfft" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="在ABINIT软件中，ngfft 是一个用于定义快速傅里叶变换（FFT）网格大小的参数。它决定了在三个维度上FFT网格的点数，直接影响计算的精度和效率。" />
<meta property="og:description" content="在ABINIT软件中，ngfft 是一个用于定义快速傅里叶变换（FFT）网格大小的参数。它决定了在三个维度上FFT网格的点数，直接影响计算的精度和效率。" />
<link rel="canonical" href="http://localhost:4000/abinit%20variables/2025/01/01/Abinit%E5%8F%98%E9%87%8Fngfft.html" />
<meta property="og:url" content="http://localhost:4000/abinit%20variables/2025/01/01/Abinit%E5%8F%98%E9%87%8Fngfft.html" />
<meta property="og:site_name" content="ZWei" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-01T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Abinit变量ngfft" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-01-01T00:00:00+01:00","datePublished":"2025-01-01T00:00:00+01:00","description":"在ABINIT软件中，ngfft 是一个用于定义快速傅里叶变换（FFT）网格大小的参数。它决定了在三个维度上FFT网格的点数，直接影响计算的精度和效率。","headline":"Abinit变量ngfft","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/abinit%20variables/2025/01/01/Abinit%E5%8F%98%E9%87%8Fngfft.html"},"url":"http://localhost:4000/abinit%20variables/2025/01/01/Abinit%E5%8F%98%E9%87%8Fngfft.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="ZWei" /><link rel="stylesheet" href="/assets/css/copy-button.css">
  
   <!-- 添加 MathJax 支持，之前网页上数学公式不显示，现这段代码后能够正常显示。 -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true
      },
      TeX: {
        extensions: ["AMSmath.js", "AMSsymbols.js"]
      }
    });
  </script>
   <!-- MathJax.js本来是个网页，我下载到了本地，然后修改了路径，现在可以正常显示了。 -->
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
</head><body><!-- 网站头部区域 -->
<header class="site-header">
  <!-- wrapper类用于控制内容宽度和居中 -->
  <div class="wrapper">
    <!-- 网站标题，点击可返回首页 -->
    <a class="site-title" rel="author" href="/">ZWei</a>

    <!-- 导航菜单区域 -->
    <nav class="site-nav">
      <!-- 汉堡菜单按钮 -->
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <div class="trigger">
        <!-- 获取所有页面路径 --><!-- 遍历所有页面 --><!-- 获取当前页面信息 --><!-- 如果页面有标题，则显示在导航栏中 --><!-- 获取当前页面信息 --><!-- 如果页面有标题，则显示在导航栏中 --><a class="page-link" href="/about/">简介</a><!-- 获取当前页面信息 --><!-- 如果页面有标题，则显示在导航栏中 --><a class="page-link" href="/blog/">博客</a><!-- 获取当前页面信息 --><!-- 如果页面有标题，则显示在导航栏中 --><!-- 获取当前页面信息 --><!-- 如果页面有标题，则显示在导航栏中 --><!-- 获取当前页面信息 --><!-- 如果页面有标题，则显示在导航栏中 --><a class="page-link" href="/nav/">导航</a><!-- 获取当前页面信息 --><!-- 如果页面有标题，则显示在导航栏中 --><a class="page-link" href="/projects/">项目</a><!-- 获取当前页面信息 --><!-- 如果页面有标题，则显示在导航栏中 --></div>
    </nav>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Abinit变量ngfft</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-01-01T00:00:00+01:00" itemprop="datePublished">Jan 1, 2025
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>在ABINIT软件中，<code class="language-plaintext highlighter-rouge">ngfft</code> 是一个用于定义快速傅里叶变换（FFT）网格大小的参数。它决定了在三个维度上FFT网格的点数，直接影响计算的精度和效率。</p>

<hr />

<h3 id="ngfft-的详细说明"><code class="language-plaintext highlighter-rouge">ngfft</code> 的详细说明</h3>

<ol>
  <li><strong>参数类型</strong>：
    <ul>
      <li><strong>变量类型</strong>：整数（integer）</li>
      <li><strong>维度</strong>：3维数组（<code class="language-plaintext highlighter-rouge">(3)</code>）</li>
    </ul>
  </li>
  <li><strong>默认值</strong>：
    <ul>
      <li><strong>默认值</strong>：<code class="language-plaintext highlighter-rouge">[0, 0, 0]</code></li>
      <li>如果未提供 <code class="language-plaintext highlighter-rouge">ngfft</code> 或其值为 <code class="language-plaintext highlighter-rouge">[0, 0, 0]</code>，ABINIT会根据 <code class="language-plaintext highlighter-rouge">acell</code>、<code class="language-plaintext highlighter-rouge">rprim</code> 和 <code class="language-plaintext highlighter-rouge">ecut</code> 自动选择最优的 <code class="language-plaintext highlighter-rouge">ngfft</code> 值。这是推荐的做法。</li>
    </ul>
  </li>
  <li><strong>作用</strong>：
    <ul>
      <li>定义FFT网格在三个维度上的点数。</li>
      <li>每个维度的点数必须是2、3、5的乘积，以与ABINIT中FFT的基数兼容。</li>
      <li>总FFT点数为：<code class="language-plaintext highlighter-rouge">ngfft(1) × ngfft(2) × ngfft(3) = %nfft</code>。</li>
    </ul>
  </li>
  <li><strong>优化与近似</strong>：
    <ul>
      <li>如果手动设置 <code class="language-plaintext highlighter-rouge">ngfft</code> 的值小于推荐值（例如通过设置 <code class="language-plaintext highlighter-rouge">boxcutmin</code> 小于2.0），代码会运行得更快，但方程会通过低通傅里叶滤波器进行近似。</li>
      <li>代码会输出一个参数 <code class="language-plaintext highlighter-rouge">boxcut</code>，表示FFT盒子边长与倒空间向量基球直径的最小比值：
        <ul>
          <li>当 <code class="language-plaintext highlighter-rouge">boxcut &lt; 2</code> 时，使用了傅里叶滤波器近似。</li>
          <li>当 <code class="language-plaintext highlighter-rouge">boxcut &lt; 1.5</code> 时，近似可能过于粗糙，结果可能不准确，建议测试更大的 <code class="language-plaintext highlighter-rouge">ngfft</code> 值。</li>
          <li>当 <code class="language-plaintext highlighter-rouge">boxcut &gt; 2</code> 时，可以减少 <code class="language-plaintext highlighter-rouge">ngfft</code> 而不损失精度。</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>内部存储</strong>：
    <ul>
      <li><code class="language-plaintext highlighter-rouge">ngfft</code> 在内部是一个大小为18的数组，其中：
        <ul>
          <li><code class="language-plaintext highlighter-rouge">ngfft(1:3)</code>：存储用户定义的或自动选择的FFT网格点数。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(4:6)</code>：存储稍大（修改后）的值，以提高FFT效率。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(7)</code>：存储 <code class="language-plaintext highlighter-rouge">fftalg</code>（FFT算法选择）。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(8)</code>：存储 <code class="language-plaintext highlighter-rouge">fftcache</code>（FFT缓存设置）。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(9)</code>：指示FFT并行化是否激活（0：未激活，1：激活）。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(10)</code>：FFT组的处理器数量。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(11)</code>：处理器在组中的索引。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(12)</code>：<code class="language-plaintext highlighter-rouge">n2proc</code>，倒空间中每个处理器处理的x-z平面数量。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(13)</code>：<code class="language-plaintext highlighter-rouge">n3proc</code>，实空间中每个处理器处理的x-y平面数量。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(14)</code>：<code class="language-plaintext highlighter-rouge">mpi_comm_fft</code>，负责FFT并行化的MPI通信器句柄。</li>
          <li><code class="language-plaintext highlighter-rouge">ngfft(15:18)</code>：尚未使用。</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>存储点数</strong>：
    <ul>
      <li>在实空间中，每个处理器存储的点数为：<code class="language-plaintext highlighter-rouge">n1 × n2 × n3proc</code>。</li>
      <li>在倒空间中，每个处理器存储的点数为：<code class="language-plaintext highlighter-rouge">n1 × n2proc × n3</code>。</li>
    </ul>
  </li>
</ol>

<h3 id="示例">示例</h3>

<p>假设你希望手动设置FFT网格点数，可以在输入文件中添加以下行：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ngfft 24 24 24
</code></pre></div></div>

<p>这将设置FFT网格在每个维度上的点数为24。</p>

<hr />

<h3 id="问abinit怎样根据-acellrprim-和-ecut-计算并自动选择最优的-ngfft-值的">问：ABINIT怎样根据 acell、rprim 和 ecut 计算并自动选择最优的 ngfft 值的？</h3>

<hr />

<p>当未提供 <code class="language-plaintext highlighter-rouge">ngfft</code> 或其值为 <code class="language-plaintext highlighter-rouge">[0, 0, 0]</code> 时，ABINIT会根据以下输入参数自动计算最优的 <code class="language-plaintext highlighter-rouge">ngfft</code> 值：</p>

<ol>
  <li><strong><code class="language-plaintext highlighter-rouge">acell</code></strong>：晶胞的初始尺寸（以玻尔半径为单位）。</li>
  <li><strong><code class="language-plaintext highlighter-rouge">rprim</code></strong>：晶胞的基向量（定义晶胞的形状和方向）。</li>
  <li><strong><code class="language-plaintext highlighter-rouge">ecut</code></strong>：平面波截断能量（以哈特里为单位）。</li>
</ol>

<p>ABINIT通过以下步骤自动选择最优的 <code class="language-plaintext highlighter-rouge">ngfft</code> 值：</p>

<h3 id="1-计算倒空间中的最大波矢">1. <strong>计算倒空间中的最大波矢</strong></h3>
<ul>
  <li>
    <p>根据 <code class="language-plaintext highlighter-rouge">ecut</code> 和平面波的动能公式：</p>

\[\frac{\hbar^2 |\mathbf{G}|^2}{2m} \leq \text{ecut}\]

    <p>其中 $\mathbf{G}$ 是倒格矢，$m$ 是电子质量。</p>
  </li>
  <li>
    <p>由此可以确定倒空间中最大波矢的长度 $|\mathbf{G}|_{\text{max}}$。</p>
  </li>
</ul>

<h3 id="2-确定实空间中的最小网格间距">2. <strong>确定实空间中的最小网格间距</strong></h3>
<ul>
  <li>根据 Nyquist 采样定理，实空间中的网格间距 $\Delta r$ 必须满足：
\(\Delta r \leq \frac{\pi}{|\mathbf{G}|_{\text{max}}}\)
以确保能够准确表示倒空间中的最高频率分量。</li>
</ul>

<h3 id="3-计算每个维度上的网格点数">3. <strong>计算每个维度上的网格点数</strong></h3>
<ul>
  <li>根据晶胞的尺寸（<code class="language-plaintext highlighter-rouge">acell</code> 和 <code class="language-plaintext highlighter-rouge">rprim</code>）和最小网格间距 $\Delta r$，计算每个维度上的网格点数：
\(\text{ngfft}(i) = \frac{\text{acell}(i) \cdot \text{rprim}(i)}{\Delta r}\)
其中 $i = 1, 2, 3$ 表示三个维度。</li>
  <li>为了满足FFT算法的要求，<code class="language-plaintext highlighter-rouge">ngfft(i)</code> 必须是2、3、5的乘积。因此，ABINIT会将计算值向上取整到最近的满足条件的整数。</li>
</ul>

<h3 id="4-考虑-boxcutmin-参数">4. <strong>考虑 <code class="language-plaintext highlighter-rouge">boxcutmin</code> 参数</strong></h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">boxcutmin</code> 是一个用户可调参数，用于控制FFT网格的最小尺寸与倒空间基球直径的比值。</li>
  <li>默认情况下，<code class="language-plaintext highlighter-rouge">boxcutmin = 2.0</code>，这意味着FFT网格的尺寸至少是倒空间基球直径的两倍，以确保高精度。</li>
  <li>如果 <code class="language-plaintext highlighter-rouge">boxcutmin</code> 设置为较小的值（如1.5），ABINIT会选择更小的 <code class="language-plaintext highlighter-rouge">ngfft</code> 值，从而加快计算速度，但会引入傅里叶滤波器近似，可能降低精度。</li>
</ul>

<h3 id="5-输出-boxcut-参数">5. <strong>输出 <code class="language-plaintext highlighter-rouge">boxcut</code> 参数</strong></h3>
<ul>
  <li>ABINIT会计算并输出 <code class="language-plaintext highlighter-rouge">boxcut</code> 参数，表示FFT网格尺寸与倒空间基球直径的实际比值：
\(\text{boxcut} = \frac{\text{FFT网格尺寸}}{\text{倒空间基球直径}}\)</li>
  <li>如果 <code class="language-plaintext highlighter-rouge">boxcut &lt; 2</code>，说明使用了傅里叶滤波器近似；如果 <code class="language-plaintext highlighter-rouge">boxcut &lt; 1.5</code>，近似可能过于粗糙，建议测试更大的 <code class="language-plaintext highlighter-rouge">ngfft</code> 值。</li>
</ul>

<h3 id="6-优化fft效率">6. <strong>优化FFT效率</strong></h3>
<ul>
  <li>ABINIT会进一步调整 <code class="language-plaintext highlighter-rouge">ngfft</code> 的值，以提高FFT计算的效率。例如，选择稍大的 <code class="language-plaintext highlighter-rouge">ngfft</code> 值，以便更好地利用缓存和并行计算资源。</li>
</ul>

<h3 id="总结">总结</h3>

<p>ABINIT自动选择 <code class="language-plaintext highlighter-rouge">ngfft</code> 的过程基于以下原则：</p>
<ol>
  <li>确保FFT网格能够准确表示倒空间中的最高频率分量（由 <code class="language-plaintext highlighter-rouge">ecut</code> 决定）。</li>
  <li>满足FFT算法的基数要求（2、3、5的乘积）。</li>
  <li>考虑 <code class="language-plaintext highlighter-rouge">boxcutmin</code> 参数，在精度和速度之间进行权衡。</li>
  <li>优化FFT计算的效率。</li>
</ol>

<p>这种自动选择机制是推荐的，因为它能够根据输入参数动态调整 <code class="language-plaintext highlighter-rouge">ngfft</code>，确保计算的精度和效率。如果需要手动设置 <code class="language-plaintext highlighter-rouge">ngfft</code>，建议先运行自动选择机制，参考其输出的 <code class="language-plaintext highlighter-rouge">boxcut</code> 值，再进行调整。</p>

  </div><a class="u-url" href="/abinit%20variables/2025/01/01/Abinit%E5%8F%98%E9%87%8Fngfft.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <!-- <h2 class="footer-heading">ZWei</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <!-- <li class="p-name">ZWei</li> -->
          <li class="p-name">联系：</li><li><a class="u-email" href="mailto:zhwei@gmx.de">zhwei@gmx.de</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li>
      <a href="https://github.com/weizhengqing">
        <svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg>
      </a>
    </li><li>
      <a href="https://orcid.org/0009-0007-3493-1400">
        <svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#orcid"></use></svg>
      </a>
    </li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>专注于计算科学、材料科学与物理学的学术博客，分享前沿研究见解与专业知识。</p>
      </div>
    </div>
  </div>
  <script src="/assets/js/copy-button.js"></script>
</footer>
</body>

</html>
